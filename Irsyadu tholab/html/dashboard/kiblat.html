<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arah Kiblat dengan Animasi</title>
    <style>
        body {
            text-align: center;
            font-family: Arial, sans-serif;
        }
        .compass-container {
            margin: 50px auto;
            width: 200px;
            height: 200px;
            position: relative;
        }
        .compass {
            width: 100%;
            height: 100%;
            border: 5px solid #333;
            border-radius: 50%;
            position: relative;
        }
        .needle {
            width: 2px;
            height: 100px;
            background-color: red;
            position: absolute;
            top: 0;
            left: 50%;
            transform-origin: 50% 100%;
            transform: rotate(0deg);
            transition: transform 2s ease;
        }
        .center-dot {
            width: 10px;
            height: 10px;
            background-color: black;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>
<body>
    <h1>Arah Kiblat dengan Animasi</h1>
    <div class="compass-container">
        <div class="compass">
            <div class="needle" id="needle"></div>
            <div class="center-dot"></div>
        </div>
    </div>
    <p id="result">Menunggu lokasi...</p>

    <script>
        const kaabaLatitude = 21.4225;
        const kaabaLongitude = 39.8262;

        // Fungsi untuk menghitung arah kiblat
        function calculateQibla(lat, long) {
            const latK = kaabaLatitude * Math.PI / 180;
            const longK = kaabaLongitude * Math.PI / 180;
            const latUser = lat * Math.PI / 180;
            const longUser = long * Math.PI / 180;

            const deltaLong = longK - longUser;
            const x = Math.cos(latK) * Math.sin(deltaLong);
            const y = Math.cos(latUser) * Math.sin(latK) - Math.sin(latUser) * Math.cos(latK) * Math.cos(deltaLong);
            const qiblaAngle = Math.atan2(x, y) * 180 / Math.PI;
            return (qiblaAngle + 360) % 360; // Untuk memastikan hasil dalam 0-360 derajat
        }

        // Fungsi untuk mendapatkan lokasi pengguna
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition);
            } else {
                alert("Geolocation tidak didukung oleh browser ini.");
            }
        }

        // Tampilkan hasil dan animasikan jarum
        function showPosition(position) {
            const lat = position.coords.latitude;
            const long = position.coords.longitude;
            const qiblaDirection = calculateQibla(lat, long);
            document.getElementById("result").innerHTML = "Arah kiblat: " + qiblaDirection.toFixed(2) + "Â° dari Utara";

            // Animasi jarum kompas ke arah kiblat
            const needle = document.getElementById("needle");
            needle.style.transform = `rotate(${qiblaDirection}deg)`;
        }

        // Memulai aplikasi dengan mendapatkan lokasi pengguna
        window.onload = getLocation;
    </script>
</body>
</html>
